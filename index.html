<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

    <script type="text/javascript" src="js/grid.js"></script>
    <script type="text/javascript" src="js/version.js"></script>
    <script type="text/javascript" src="js/detector.js"></script>
    <script type="text/javascript" src="js/formatinf.js"></script>
    <script type="text/javascript" src="js/errorlevel.js"></script>
    <script type="text/javascript" src="js/bitmat.js"></script>
    <script type="text/javascript" src="js/datablock.js"></script>
    <script type="text/javascript" src="js/bmparser.js"></script>
    <script type="text/javascript" src="js/datamask.js"></script>
    <script type="text/javascript" src="js/rsdecoder.js"></script>
    <script type="text/javascript" src="js/gf256poly.js"></script>
    <script type="text/javascript" src="js/gf256.js"></script>
    <script type="text/javascript" src="js/decoder.js"></script>
    <script type="text/javascript" src="js/qrcode.js"></script>
    <script type="text/javascript" src="js/findpat.js"></script>
    <script type="text/javascript" src="js/alignpat.js"></script>
    <script type="text/javascript" src="js/databr.js"></script>
    <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <h3>Take a photo of the QR code</h3>
    <input type="file" name="image" accept="image/*">
    <canvas id="qr-canvas"></canvas>

    <script>

        function read(a)
        {
            alert(a);
        }

        $('input[name=image]').change(function(e) {
            var file = e.target.files[0];

            // Only process image files
            if (!file.type.match('image.*')) {
                return;
            }

            var reader = new FileReader();

            reader.onloadend = function(e){

                var image = new Image();
                image.onload = function(e){
                    var canvas = document.getElementById("qr-canvas");
                    var context = canvas.getContext("2d");

                    var MAX_WIDTH = 800;
                    var MAX_HEIGHT = 800;
                    var width = image.width;
                    var height = image.height;

                    if (width > height) {
                      if (width > MAX_WIDTH) {
                        height *= MAX_WIDTH / width;
                        width = MAX_WIDTH;
                      }
                    } else {
                      if (height > MAX_HEIGHT) {
                        width *= MAX_HEIGHT / height;
                        height = MAX_HEIGHT;
                      }
                    }
                    canvas.width = width;
                    canvas.height = height;
                    context.drawImage(image, 0, 0, width, height);

                    try{
                        qrcode.callback = read;
                        qrcode.decode();
                    } catch(err) {
                        //log detailed error here
                        alert("QR code not recognized, please try again. Details: " + err);
                    }
                }

                image.src = e.target.result;
            }

            reader.readAsDataURL(file);
        });

    </script>
</body>
</html>